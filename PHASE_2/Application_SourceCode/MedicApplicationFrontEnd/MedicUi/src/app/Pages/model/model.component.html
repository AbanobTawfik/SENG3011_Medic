<div *ngIf="!error && !loaded" class="m-3 text-center"><div class="spinner-border" role="status">
  <span class="sr-only">Loading...</span>
</div></div>
<div *ngIf="error" class="alert alert-danger m-3" role="alert">
  {{error}}
  <a [href]="url">{{url}}</a>
</div>
<div *ngIf="loaded" class="p-3">
  <h4>{{article.headline}} <span class="badge badge-info">ONGOING</span></h4>
  <p>Source: CDC (<a href="https://www.cdc.gov">https://www.cdc.gov</a>)</p>
  <ngb-accordion #a="ngbAccordion" activeIds="statistics,articles">
    <ngb-panel id="statistics" type="info">
      <ng-template ngbPanelHeader let-opened="opened">
        <div class="d-flex align-items-center justify-content-between" ngbPanelToggle>
          <h6 class="m-0 text-white">Modelling (SEIR Model)</h6><button ngbPanelToggle class="btn p-0 text-white">{{ opened ? 'Collapse' : 'Show' }}</button>
        </div>
      </ng-template>
      <ng-template ngbPanelContent>
        <div class="row mb-3">
          <div class="col-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="checkSusceptible" disabled>
              <label class="form-check-label" for="checkSusceptible">Susceptible
                <p class="small">Number of individuals susceptible to the disease</p>
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="checkExposed" value="exposed" name="exposed" [(ngModel)]="exposed">
              <label class="form-check-label" for="checkExposed" style="color: #FF9800">Exposed
                <p class="small">{{timeline[hoverIndex].exposed}}<br>Number of individuals currently in incubation</p>
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="checkInfectious" value="infectious" name="infectious" [(ngModel)]="infectious">
              <label class="form-check-label" for="checkInfectious" style="color: #E91E63">Infectious
                <p class="small">{{timeline[hoverIndex].infected}}<br>Number of infectious individuals</p>
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="checkRemoved" value="removed" name="removed" [(ngModel)]="removed">
              <label class="form-check-label" for="checkRemoved">Removed
                <p class="small">Number of individuals no longer infectious</p>
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="checkRecovered" value="recovered" name="recovered" [(ngModel)]="recovered">
              <label class="form-check-label" for="checkRecovered" style="color: #8BC34A;">Recovered
                <p class="small">{{timeline[hoverIndex].recovered}}</p>
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="checkHospitalised" value="hospitalised" name="hospitalised" [(ngModel)]="hospitalised">
              <label class="form-check-label" for="checkHospitalised" style="color: #03A9F4">Hospitalised
                <p class="small">{{timeline[hoverIndex].hospitalized}}</p>
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="checkDeaths" value="deaths" name="deaths" [(ngModel)]="deaths">
              <label class="form-check-label" for="checkDeaths" style="color: #9E9E9E">Deaths
                <p class="small">{{timeline[hoverIndex].deaths}}</p>
              </label>
            </div>
          </div>
          <div class="col mx-3 p-3">
            <div class="position-relative" style="display: block;">
              <canvas baseChart
                [datasets]="totalChartData"
                [options]="totalChartOptions"
                chartType="line"
                (chartHover)="onChartHover($event)">
              </canvas>
              <div *ngIf="loadingLine" class="spinner-border text-secondary spinner-center" role="status">
                <span class="sr-only">Loading...</span>
              </div>
            </div>
          </div>
          <div class="col mx-3 p-3 d-none">
            <h6>Daily cases</h6>
            <div class="position-relative" style="display: block;">
              <canvas baseChart
                [datasets]="dailyChartData"
                [options]="dailyChartOptions"
                chartType="line">
              </canvas>
              <div *ngIf="loadingLine2" class="spinner-border text-secondary spinner-center" role="status">
                <span class="sr-only">Loading...</span>
              </div>
            </div>
          </div>
        </div>
        <div class="card p-3">
          <form>
            <h6>Transmission parameters</h6>
            <div class="form-row mb-1">
              <div class="col-md-3 pr-3">
                <div class="form-group row mb-0">
                  <label class="col-sm-6 col-form-label-sm mb-1 pr-0" for="population">Population size</label>
                  <div class="col-sm-6">
                    <input type="text" class="form-control form-control-sm" id="population" (input)="onPopChange($event);updateTimeline()" [(ngModel)]="textPop" name="popText">
                  </div>
                </div>
                <input type="range" class="custom-range" min="2" max="9" step="0.01" (input)="onPopChange($event);updateTimeline()" [(ngModel)]="sliderPop" name="pop">
              </div>
              <div class="col-md-2 px-3 border-left">
                <div class="row">
                  <label class="col-sm-6 col-form-label-sm mb-1 pr-0" for="initial">Initial infections</label>
                  <div class="col-sm-6">
                    <input type="number" class="form-control form-control-sm mb-1" min="1" max="1000" id="initial" (input)="updateTimeline()" [(ngModel)]="initial" name="initialNum">
                    <input type="range" class="custom-range" min="1" max="1000" (input)="updateTimeline()" [(ngModel)]="initial" name="initial">
                  </div>
                </div>
              </div>
              <div class="col-md-3 px-3 border-left">
                <div class="row">
                  <label class="col-sm-8 col-form-label-sm mb-1 pr-0" for="r0">Basic reproduction number R<sub>0</sub> (secondary infections)</label>
                  <div class="col-sm-4">
                    <input type="number" class="form-control form-control-sm mb-1" min="0.01" max="10" step="0.01" id="r0" (input)="updateTimeline()" [(ngModel)]="r0" name="r0Num">
                    <input type="range" class="custom-range" min="0.01" max="10" step="0.01" (input)="updateTimeline()" [(ngModel)]="r0" name="r0">
                  </div>
                </div>
              </div>
              <div class="col-md-2 px-3 border-left">
                <div class="row">
                  <label class="col-sm-7 col-form-label-sm mb-1 pr-0" for="dIncubation">Incubation period (days)</label>
                  <div class="col-sm-5">
                    <input type="text" class="form-control form-control-sm mb-1" id="dIncubation" (input)="updateTimeline()" [(ngModel)]="dIncubation" name="dIncubationNum">
                    <input type="range" class="custom-range" min="0.1" max="30" step="0.1" (input)="updateTimeline()" [(ngModel)]="dIncubation" name="dIncubation">
                  </div>
                </div>
              </div>
              <div class="col-md-2 px-3 border-left">
                <div class="row">
                  <label class="col-sm-7 col-form-label-sm mb-1 pr-0" for="r0">Infectious duration (days)</label>
                  <div class="col-sm-5">
                    <input type="text" class="form-control form-control-sm mb-1" id="dInfectious" (input)="updateTimeline()" [(ngModel)]="dInfectious" name="dInfectiousNum">
                    <input type="range" class="custom-range" min="0.1" max="30" step="0.1" (input)="updateTimeline()" [(ngModel)]="dInfectious" name="dInfectious">
                  </div>
                </div>
              </div>
            </div>
            <h6>Response parameters</h6>
            <div class="form-row mb-1">
              <div class="col-md-2 pr-3">
                <div class="row">
                  <label class="col-sm-6 col-form-label-sm mb-1 pr-0" for="initial">Case fatality rate (%)</label>
                  <div class="col-sm-6">
                    <input type="number" class="form-control form-control-sm mb-1" min="0" max="100" step="0.01" id="cfr" (input)="updateTimeline()" [(ngModel)]="cfr" name="cfrNum">
                    <input type="range" class="custom-range" min="0" max="100" step="0.01" (input)="updateTimeline()" [(ngModel)]="cfr" name="cfr">
                  </div>
                </div>
              </div>
              <div class="col-md-2 px-3 border-left">
                <div class="row">
                  <label class="col-sm-7 col-form-label-sm mb-1 pr-0" for="initial">Incubation end to death (days)</label>
                  <div class="col-sm-5">
                    <input type="text" class="form-control form-control-sm mb-1" id="dDeath" (input)="updateTimeline()" [(ngModel)]="dDeath" name="dDeathNum">
                    <input type="range" class="custom-range" min="0" max="100" step="0.1" (input)="updateTimeline()" [(ngModel)]="dDeath" name="dDeath">
                  </div>
                </div>
              </div>
              <div class="col-md-2 px-3 border-left">
                <div class="row">
                  <label class="col-sm-7 col-form-label-sm mb-1 pr-0" for="initial">Mild case recovery (days)</label>
                  <div class="col-sm-5">
                    <input type="text" class="form-control form-control-sm mb-1" id="dRecoveryMild" (input)="updateTimeline()" [(ngModel)]="dRecoveryMild" name="dRecoveryMildNum">
                    <input type="range" class="custom-range" min="0" max="100" step="0.1" (input)="updateTimeline()" [(ngModel)]="dRecoveryMild" name="dRecoveryMild">
                  </div>
                </div>
              </div>
              <div class="col-md-2 px-3 border-left">
                <div class="row">
                  <label class="col-sm-7 col-form-label-sm mb-1 pr-0" for="initial">Hospital recovery (days)</label>
                  <div class="col-sm-5">
                    <input type="text" class="form-control form-control-sm mb-1" id="dRecoverySevere" (input)="updateTimeline()" [(ngModel)]="dRecoverySevere" name="dRecoverySevereNum">
                    <input type="range" class="custom-range" min="0" max="100" step="0.1" (input)="updateTimeline()" [(ngModel)]="dRecoverySevere" name="dRecoverySevere">
                  </div>
                </div>
              </div>
              <div class="col-md-2 px-3 border-left">
                <div class="row">
                  <label class="col-sm-7 col-form-label-sm mb-1 pr-0" for="initial">Hospitalisation rate (%)</label>
                  <div class="col-sm-5">
                    <input type="text" class="form-control form-control-sm mb-1" id="pServere" (input)="updateTimeline()" [(ngModel)]="pServere" name="pServereNum">
                    <input type="range" class="custom-range" min="0" max="100" step="0.1" (input)="updateTimeline()" [(ngModel)]="pServere" name="pServere">
                  </div>
                </div>
              </div>
              <div class="col-md-2 px-3 border-left">
                <div class="row">
                  <label class="col-sm-7 col-form-label-sm mb-1 pr-0" for="initial">Hospitalisation delay (days)</label>
                  <div class="col-sm-5">
                    <input type="text" class="form-control form-control-sm mb-1" id="dHospitalLag" (input)="updateTimeline()" [(ngModel)]="dHospitalLag" name="dHospitalLagNum">
                    <input type="range" class="custom-range" min="0" max="100" step="0.1" (input)="updateTimeline()" [(ngModel)]="dHospitalLag" name="dHospitalLag">
                  </div>
                </div>
              </div>
            </div>
            <h6>Reduction parameters</h6>
            <div class="form-row mb-1">
              <div class="col-md-4 pr-3">
                <div class="row">
                  <label class="col-sm-6 col-form-label-sm mb-1 pr-0" for="r0ReductionPercent">R<sub>0</sub> reduction percent</label>
                  <div class="form-inline col-sm-6 p-0 row">
                    <input type="range" class="col-sm-8 custom-range px-3" min="0" max="100" step="0.01" (input)="updateTimeline()" [(ngModel)]="r0ReductionPercent" name="r0ReductionPercent">
                    <input type="number" class="col-sm-4 form-control form-control-sm mb-1" min="0" max="100" step="0.01" id="r0ReductionPercent" (input)="updateTimeline()" [(ngModel)]="r0ReductionPercent" name="r0ReductionPercentNum">
                  </div>
                </div>
              </div>
              <div class="col-md-3 px-3 border-left">
                <div class="row">
                  <label class="col-sm-5 col-form-label-sm mb-1 pr-0" for="initial">Reduction date</label>
                  <div class="col-sm-7 input-group input-group-sm" id="peak">
                    <input class="form-control" placeholder="yyyy-mm-dd" name="from" #peak (dateSelect)="updateInput(peak)" (input)="onDateChange()" ngbDatepicker #peakPicker="ngbDatepicker" [(ngModel)]="peakDate">
                    <div class="input-group-append input-group-sm">
                      <button class="btn btn-outline-secondary form-control pt-0" (click)="peakPicker.toggle()" type="button">
                        <svg class="bi bi-calendar" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                          <path fill-rule="evenodd" d="M14 0H2a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2zM1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857V3.857z" clip-rule="evenodd"/>
                          <path fill-rule="evenodd" d="M6.5 7a1 1 0 100-2 1 1 0 000 2zm3 0a1 1 0 100-2 1 1 0 000 2zm3 0a1 1 0 100-2 1 1 0 000 2zm-9 3a1 1 0 100-2 1 1 0 000 2zm3 0a1 1 0 100-2 1 1 0 000 2zm3 0a1 1 0 100-2 1 1 0 000 2zm3 0a1 1 0 100-2 1 1 0 000 2zm-9 3a1 1 0 100-2 1 1 0 000 2zm3 0a1 1 0 100-2 1 1 0 000 2zm3 0a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </ng-template>
    </ngb-panel>
    <ngb-panel id="articles">
      <ng-template ngbPanelHeader let-opened="opened">
        <div class="d-flex align-items-center justify-content-between" ngbPanelToggle>
          <h6 class="m-0">Sources</h6><button ngbPanelToggle class="btn p-0">{{ opened ? 'Collapse' : 'Show' }}</button>
        </div>
      </ng-template>
      <ng-template ngbPanelContent>
        <div class="card p-3">
          <h5>"{{article.headline}}"</h5>
          <ul>
            <li>Source: <a [href]="url">{{url}}</a></li>
            <li>Date of publication: {{article.dateOfPublicationStr}}</li>
          </ul>
          <p *ngFor="let p of article.mainText.split('\n')">
            {{p}}
          </p>
        </div>
      </ng-template>
    </ngb-panel>
  </ngb-accordion>
</div>